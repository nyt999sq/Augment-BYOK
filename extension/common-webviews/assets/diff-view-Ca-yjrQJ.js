import{an as Xe,at as Ye,aK as De,w as se,aZ as Re,W as $,ar as H,a_ as ye,aO as Me,v as ue,x as Y,H as k,af as qe,ag as ze,S as le,a7 as Ne,z as n,P as F,N as f,V as Ce,B as ce,aR as Ue,L as S,R as w,Q as Z,D as L,Z as D,aT as Be,X as ge,C as be,F as y,A as R,a3 as me,J as He,aI as Ae,K as Ee,Y as xe,aj as Ze,_ as ke,ak as Pe,ae as et,ac as tt,aG as Ie,aJ as it,aq as st,aH as ot}from"./Icon-CaBYD5oO.js";import"./design-system-init-DCR3FqZN.js";import{a as nt,g as rt,C as dt,M as at}from"./index-DF_yYUtg.js";import{n as ut,p as lt,b as Se,u as ct,q as ht,t as ft,v as gt,w as mt,S as _t,F as pt}from"./extension-client-context-CwKdOhUw.js";import{d as vt}from"./index-B4NDmpYR.js";import{r as Ct,a as Te}from"./monaco-render-utils-BmFM_Kj0.js";import{a as Ge,I as kt}from"./IconButtonAugment-Rffikxkp.js";import{B as X}from"./ButtonAugment-DECgcPdk.js";import{T as bt,a as wt}from"./TextTooltipAugment-B4cqQh4H.js";import{K as yt,A as It,R as We,P as Mt}from"./Keybindings-4dJzjBQT.js";import"./marked.esm-CBEAPn3z.js";import"./message-broker-CliB7GoL.js";import"./_commonjsHelpers-CwkBNZ52.js";import"./types-CaiUesx9.js";import"./await-bImbqfxU.js";import"./BaseTextInput-CPpF4fmq.js";import"./Chevron-Ct6H6suA.js";import"./CalloutAugment-DfDZpfuE.js";import"./Filespan-CzwbVFJm.js";import"./TextCombo-89YZbRHm.js";try{de=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},($e=new de.Error().stack)&&(de._sentryDebugIds=de._sentryDebugIds||{},de._sentryDebugIds[$e]="68ebf928-dc92-4af8-9af4-f840670d8607",de._sentryDebugIdIdentifier="sentry-dbid-68ebf928-dc92-4af8-9af4-f840670d8607")}catch{}var de,$e;function Je(a){return function(e){return"unitOfCodeWork"in e&&!function(t){return t.children.length>0&&"childIds"in t}(e)}(a)?[a]:a.children.flatMap(Je)}var ae=(a=>(a.edit="edit",a.instruction="instruction",a))(ae||{}),Le=(a=>(a[a.instructionDrawer=0]="instructionDrawer",a[a.chunkActionPanel=1]="chunkActionPanel",a))(Le||{});class Et{_items=[];_focusedItemIdx;_subscribers=new Set;constructor(e=[]){this._items=e}subscribe=e=>(this._subscribers.add(e),e(this),()=>{this._subscribers.delete(e)});get items(){return this._items}get focusedItem(){if(this._focusedItemIdx!==void 0)return this._items[this._focusedItemIdx]}get focusedItemIdx(){return this._focusedItemIdx}setItems=e=>{this._items=e,this._items.length===0?this.setFocusIdx(void 0):this._focusedItemIdx!==void 0&&this._focusedItemIdx>=this._items.length?this.setFocusIdx(this._items.length-1):this._focusedItemIdx===void 0?this.setFocusIdx(void 0):this.setFocusIdx(this._focusedItemIdx)};setFocus=e=>{if(e!==void 0&&e===this.focusedItem)return;const t=e?this._items.indexOf(e):-1;t===-1?this.setFocusIdx(void 0):this.setFocusIdx(t)};setFocusIdx=e=>{if(e===this._focusedItemIdx||this._items.length===0)return;if(e===void 0)return this._focusedItemIdx=void 0,void this.notifySubscribers();const t=Math.floor(e/this._items.length)*this._items.length;this._focusedItemIdx=(e-t)%this._items.length,this.notifySubscribers()};initFocusIdx=e=>this._focusedItemIdx===void 0&&(this.setFocusIdx(e),!0);focusNext=()=>{const e=this.nextIdx();if(e!==void 0)return this.setFocus(this._items[e]),e};focusPrev=()=>{const e=this.prevIdx();if(e!==void 0)return this.setFocus(this._items[e]),e};prevIdx=(e={})=>{if(this._items.length!==0)return this._focusedItemIdx===void 0?this._items.length-1:e.nowrap&&this._focusedItemIdx===0?0:(this._focusedItemIdx-1+this._items.length)%this._items.length};nextIdx=(e={})=>{if(this._items.length!==0)return this._focusedItemIdx===void 0?0:e.nowrap&&this._focusedItemIdx===this._items.length-1?this._items.length-1:(this._focusedItemIdx+1)%this._items.length};notifySubscribers=()=>{this._subscribers.forEach(e=>e(this))}}class xt{constructor(e,t,i){this.id=e,this.originalCode=t,this._monaco=i,this._originalModel=this._monaco.editor.createModel(t),this._modifiedModel=this._monaco.editor.createModel(t)}_originalModel;_modifiedModel;_fullEdits=[];_currEdit;_currOriginalEdit;swapBaseModel=e=>{this._originalModel.setValue(e),this._modifiedModel.setValue(e),this._fullEdits.forEach(t=>{this._modifiedModel.applyEdits([t])}),this._currEdit&&this._modifiedModel.applyEdits([this._currEdit]),this._currOriginalEdit&&this._originalModel.applyEdits([this._currOriginalEdit])};finish=()=>this._completeCurrEdit();onReceiveChunk=e=>e.data.newChunkStart?this._startNewEdit(e.data.newChunkStart):e.data.chunkContinue&&this._currEdit?this._continueEdit(e.data.chunkContinue):e.data.chunkEnd&&this._currEdit?this._completeCurrEdit(e.data.chunkEnd):void 0;get hasReceivedFirstChunk(){return this._currEdit!==void 0||this._fullEdits.length>0}get originalValue(){return this._originalModel.getValue()}get modifiedValue(){return this._modifiedModel.getValue()}get currEdit(){return this._currEdit}_completeCurrEdit=e=>{const t={resetOriginal:[],original:[],modified:[]};if(!e)return t;if(this._currEdit){this._currEdit.range=new this._monaco.Range(e.stagedStartLine,0,e.stagedEndLine,0);const i=this._nextModifiedInsertPosition(),o=e.stagedEndLine-e.stagedStartLine,s={range:new this._monaco.Range(i.lineNumber,0,i.lineNumber+o,0),text:""};t.modified.push(s),this._modifiedModel.applyEdits([s]),this._fullEdits.push(this._currEdit),this._currEdit=void 0}return t};_startNewEdit=e=>{const t={resetOriginal:[],original:[],modified:[]};return this._currOriginalEdit=void 0,this._currEdit={range:new this._monaco.Range(e.stagedStartLine,0,e.stagedStartLine,0),text:""},t.modified.push(this._currEdit),this._modifiedModel.applyEdits([this._currEdit]),t};_continueEdit=e=>{if(!this._currEdit)throw new Error("No current edit");const t=this._nextModifiedInsertPosition(),i={...this._currEdit,text:e.newText,range:new this._monaco.Range(t.lineNumber,t.column,t.lineNumber,t.column)};return this._modifiedModel.applyEdits([i]),this._currEdit.text+=e.newText,{resetOriginal:[],original:[],modified:e.newText.length>0?[i]:[]}};_nextModifiedInsertPosition=()=>{if(!this._currEdit)throw new Error("No current edit");const e=this._modifiedModel.getOffsetAt({lineNumber:this._currEdit.range.startLineNumber,column:this._currEdit.range.startColumn})+(this._currEdit.text?.length??0);return this._modifiedModel.getPositionAt(e)}}class St{constructor(e,t,i,o){this._editorContainer=e,this._reduxStore=t,this._monaco=o,this._asyncMsgSender=new Xe(s=>Ye.postMessage(s)),this.initializeEditor(i)}_asyncMsgSender;_editor;_focusModel=new Et;_hasScrolledOnInit=!1;_markHasScrolledOnInit=De(()=>{this._hasScrolledOnInit=!0},200);_resetScrollOnInit=()=>{this._markHasScrolledOnInit.cancel(),this._hasScrolledOnInit=!1};_subscribers=new Set;_disposables=[];_rootChunk;_keybindings=se({});_requestId=se(void 0);requestId=this._requestId;_disableResolution=se(!1);disableResolution=Re(this._disableResolution);_disableApply=se(!1);disableApply=Re(this._disableApply);_currStream;_isLoadingDiffChunks=se(!1);_selectionLines=se(void 0);_mode=se(ae.edit);initializeEditor=e=>{this._editor=this._monaco.editor.createDiffEditor(this._editorContainer,{automaticLayout:!0,theme:e,readOnly:!0,contextmenu:!1,renderSideBySide:!1,renderIndicators:!0,renderMarginRevertIcon:!1,originalEditable:!1,diffCodeLens:!1,renderOverviewRuler:!1,ignoreTrimWhitespace:!1,scrollBeyondLastLine:!0,maxComputationTime:0,minimap:{enabled:!1},padding:{top:16}}),this._editor.getOriginalEditor().updateOptions({lineNumbers:"off"}),this._monaco.editor.registerCommand?.("acceptFocusedChunk",this.acceptFocusedChunk),this._monaco.editor.registerCommand?.("rejectFocusedChunk",this.rejectFocusedChunk),this._monaco.editor.registerCommand?.("acceptAllChunks",this.acceptAllChunks),this._monaco.editor.registerCommand?.("rejectAllChunks",this.rejectAllChunks),this._monaco.editor.registerCommand?.("focusNextChunk",this.focusNextChunk),this._monaco.editor.registerCommand?.("focusPrevChunk",this.focusPrevChunk),this._disposables.push(this._editor,this._editor.onDidUpdateDiff(this.onDidUpdateDiff),this._editor.getModifiedEditor().onMouseMove(this.onMouseMoveModified),{dispose:this._focusModel.subscribe(t=>this.notifySubscribers())}),this.initialize()};subscribe=e=>(this._subscribers.add(e),e(this),()=>{this._subscribers.delete(e)});dispose=()=>{this._editor.dispose(),this._subscribers.clear(),this._disposables.forEach(e=>e.dispose())};notifySubscribers=()=>{this._subscribers.forEach(e=>e(this))};onDidUpdateDiff=()=>{if(this.updateCodeChunk(),!this._hasScrolledOnInit&&this.leaves?.length){this._markHasScrolledOnInit();const e=this.leaves[0];this.revealChunk(e)}this.notifyDiffViewUpdated(),this.notifySubscribers()};onMouseMoveModified=e=>{if(e.target.position?.lineNumber===void 0||this.leaves===void 0)return;const t=this.editorOffset,i=e.target.position?.lineNumber;for(let o=0;o<this.leaves.length;o++){const s=this.leaves[o],r=s.unitOfCodeWork.lineChanges?.lineChanges[0].modifiedStart,d=s.unitOfCodeWork.lineChanges?.lineChanges[0].modifiedEnd,c=s.unitOfCodeWork.lineChanges?.lineChanges[0].originalStart,g=s.unitOfCodeWork.lineChanges?.lineChanges[0].originalEnd;if(r!==void 0&&d!==void 0&&c!==void 0&&g!==void 0){if(r!==d||i!==r){if(r<=i&&i<d){this.setCurrFocusedChunkIdx(o,!1);break}}else if(e.target.type===this._monaco.editor.MouseTargetType.CONTENT_VIEW_ZONE){const u=this._editor.getOriginalEditor(),l=u.getOption(this._monaco.editor.EditorOption.lineHeight),p=u.getScrolledVisiblePosition({lineNumber:c,column:0}),v=u.getScrolledVisiblePosition({lineNumber:g+1,column:0});if(p===null||v===null)continue;const M=p.top-l/2+t,A=v.top-l/2+t;if(e.event.posy>=M&&e.event.posy<=A){this.setCurrFocusedChunkIdx(o,!1);break}break}}}};get editorOffset(){return this._editorContainer.getBoundingClientRect().top}get currFocusedChunkIdx(){return this._focusModel.focusedItemIdx}get selectionLines(){return this._selectionLines}get mode(){return this._mode}get keybindings(){return this._keybindings}getOriginalEditor(){return this._editor.getOriginalEditor()}getModifiedEditor(){return this._editor.getModifiedEditor()}get isLoading(){return{subscribe:this._isLoadingDiffChunks.subscribe}}setLoading(e){this._isLoadingDiffChunks.set(e)}updateIsWebviewFocused=async e=>{await this._asyncMsgSender.send({type:$.diffViewWindowFocusChange,data:e})};setCurrFocusedChunkIdx=(e,t=!0)=>{this._focusModel.focusedItemIdx!==e&&(this._focusModel.setFocusIdx(e),t&&this.revealCurrFocusedChunk(),this.notifySubscribers())};revealCurrFocusedChunk=()=>{const e=this._focusModel.focusedItem;e&&this.revealChunk(e)};revealChunk=e=>{const t=e.unitOfCodeWork.lineChanges?.lineChanges[0],i=t?.modifiedStart;i!==void 0&&this._editor.revealLineNearTop(i-1)};renderCentralOverlayWidget=e=>{const t=()=>({editor:this._editor,id:"central-overlay-widget"}),i=Ct(e,t(),{monaco:this._monaco});return{update:()=>{i.update(t())},destroy:i.destroy}};renderInstructionsDrawerViewZone=(e,t)=>{let i=!1,o=t;const s=t.autoFocus??!0,r=u=>{s&&!i&&(this._editor.revealLineNearTop(u),i=!0)},d=u=>({...u,ordinal:Le.instructionDrawer,editor:this._editor,afterLineNumber:u.line}),c=Te(e,d(t)),g=[];return s&&g.push(this._editor.onDidUpdateDiff(()=>{r(o.line)})),{update:u=>{const l={...o,...u};vt(l,o)||(c.update(d(l)),o=l,r(l.line))},destroy:()=>{c.destroy(),g.forEach(u=>u.dispose())}}};renderActionsViewZone=(e,t)=>{const i=s=>{let r;return r=s.chunk?s.chunk.unitOfCodeWork.lineChanges?.lineChanges[0].modifiedStart:1,{...s,ordinal:Le.chunkActionPanel,editor:this._editor,afterLineNumber:r?r-1:void 0}},o=Te(e,i(t));return{update:s=>{o.update(i(s))},destroy:o.destroy}};acceptAllChunks=()=>{this.leaves&&this.acceptChunks(this.leaves,!0)};rejectAllChunks=()=>{this.leaves&&this.rejectChunks(this.leaves,!0)};acceptFocusedChunk=()=>{const e=this._focusModel.focusedItem;e&&this.acceptChunk(e)};rejectFocusedChunk=()=>{const e=this._focusModel.focusedItem;e&&this.rejectChunk(e)};focusNextChunk=()=>{this._focusModel.focusNext(),this.revealCurrFocusedChunk()};focusPrevChunk=()=>{this._focusModel.focusPrev(),this.revealCurrFocusedChunk()};initialize=async()=>{const e=await this._asyncMsgSender.send({type:$.diffViewLoaded},2e3);this._resetScrollOnInit();const{file:t,instruction:i,keybindings:o,editable:s}=e.data;this._editor.updateOptions({readOnly:!s});const r=H(this._keybindings);this._keybindings.set(o??r);const d=i?.selection;d&&(d.start.line===d.end.line&&d.start.character===d.end.character&&this._mode.set(ae.instruction),H(this.selectionLines)===void 0&&this._selectionLines.set({start:d.start.line,end:d.end.line})),this.updateModels(t.originalCode??"",t.modifiedCode??"",{rootPath:t.repoRoot,relPath:t.pathName}),this._currStream?.finish(),this._currStream=void 0,this._disableResolution.set(!!e.data.disableResolution),this._disableApply.set(!!e.data.disableApply),await this._tryFetchStream(),this._syncStreamToModels()};disposeDiffViewPanel=async()=>{await this._asyncMsgSender.send({type:$.disposeDiffView})};_tryFetchStream=async()=>{const e=this._asyncMsgSender.stream({type:$.diffViewFetchPendingStream},15e3,6e4);for await(const t of e)switch(t.type){case $.diffViewDiffStreamStarted:{this.setLoading(!0),this._requestId.set(t.data.requestId);const i=this._editor.getOriginalEditor().getValue();this._currStream=new xt(t.data.streamId,i,this._monaco),this._syncStreamToModels();break}case $.diffViewDiffStreamEnded:if(this._currStream?.id!==t.data.streamId)return;this.setLoading(!1),this._cleanupStream();break;case $.diffViewDiffStreamChunk:{if(this._currStream?.id!==t.data.streamId)return;const i=this._editor.getOriginalEditor().getModel();if(!this._editor.getModifiedEditor().getModel()||!i)return this.setLoading(!1),void this._cleanupStream();const o=this._currStream?.onReceiveChunk(t);o&&(this._applyDeltaDiff(o),H(this._selectionLines)!=null&&this._selectionLines.set(null));break}}};handleMessageFromExtension=async e=>{switch(e.data.type){case $.diffViewNotifyReinit:this.setLoading(!1),this._cleanupStream(),this.initialize();break;case $.diffViewAcceptAllChunks:this.acceptAllChunks();break;case $.diffViewAcceptFocusedChunk:this.acceptFocusedChunk();break;case $.diffViewRejectFocusedChunk:this.rejectFocusedChunk();break;case $.diffViewFocusPrevChunk:this.focusPrevChunk();break;case $.diffViewFocusNextChunk:this.focusNextChunk()}};_applyDeltaDiff=e=>{const t=this._editor.getOriginalEditor().getModel(),i=this._editor.getModifiedEditor().getModel();t&&i&&(t.pushEditOperations([],e.resetOriginal,()=>[]),e.original.forEach(o=>{t.pushEditOperations([],[o],()=>[])}),e.modified.forEach(o=>{i.pushEditOperations([],[o],()=>[])}))};_cleanupStream=()=>{if(this._currStream){const e=this._currStream?.finish();this._applyDeltaDiff(e),this._currStream=void 0,this._resetScrollOnInit()}};_syncStreamToModels=()=>{const e=this._currStream?.originalValue,t=this._currStream?.modifiedValue;e&&e!==this._editor.getOriginalEditor().getValue()&&this._editor.getOriginalEditor().setValue(e),t&&t!==this._editor.getModifiedEditor().getValue()&&this._editor.getModifiedEditor().setValue(t)};acceptChunk=async e=>{H(this._disableApply)||this.acceptChunks([e])};acceptChunks=async(e,t=!1)=>{H(this._disableApply)||(this.executeDiffChunks(e,!0),this.notifyResolvedChunks(e,ye.accept,t),await Me(),this.areModelsEqual()&&!H(this.isLoading)&&this.disposeDiffViewPanel())};areModelsEqual=()=>{const e=this._editor.getModel()?.original,t=this._editor.getModel()?.modified;return e?.getValue()===t?.getValue()};rejectChunk=async e=>{this.rejectChunks([e])};rejectChunks=async(e,t=!1)=>{this.executeDiffChunks(e,!1),this.notifyResolvedChunks(e,ye.reject,t),await Me(),this.areModelsEqual()&&!H(this.isLoading)&&this.disposeDiffViewPanel()};get _originalCode(){return this._currStream?.originalCode??this._editor.getOriginalEditor().getValue()}get _modifiedCode(){return this._editor.getModifiedEditor().getValue()}notifyDiffViewUpdated=De(()=>{this.notifyResolvedChunks([],ye.accept)},1e3);notifyResolvedChunks=async(e,t,i=!1)=>{const o=this._editor.getModel()?.original.uri.path;o&&await this._asyncMsgSender.send({type:$.diffViewResolveChunk,data:{file:{repoRoot:"",pathName:o,originalCode:this._originalCode,modifiedCode:this._modifiedCode},changes:e.map(s=>s.unitOfCodeWork),resolveType:t,shouldApplyToAll:i}},2e3)};executeDiffChunks=(e,t)=>{if(H(this._disableResolution)||t&&H(this._disableApply))return;const i=this._editor.getModel()?.original,o=this._editor.getModel()?.modified;if(!i||!o||this._currStream!==void 0)return;const s=[],r=[];for(const u of e){const l=u.unitOfCodeWork.lineChanges?.lineChanges[0];if(!l||u.unitOfCodeWork.originalCode===void 0||u.unitOfCodeWork.modifiedCode===void 0)continue;let p={startLineNumber:l.originalStart,startColumn:1,endLineNumber:l.originalEnd,endColumn:1},v={startLineNumber:l.modifiedStart,startColumn:1,endLineNumber:l.modifiedEnd,endColumn:1};const M=t?u.unitOfCodeWork.modifiedCode:u.unitOfCodeWork.originalCode;M!==void 0&&(s.push({range:p,text:M}),r.push({range:v,text:M}))}i.pushEditOperations([],s,()=>[]),o.pushEditOperations([],r,()=>[]);const d=this._focusModel.nextIdx({nowrap:!0});if(d===void 0)return;const c=d===this._focusModel.focusedItemIdx?d-1:d,g=this._focusModel.items[c];g&&this.revealChunk(g)};get leaves(){const e=this.codeChunk;if(e)return Je(e)}get codeChunk(){return this._rootChunk}updateCodeChunk=()=>{this._rootChunk=this.computeCodeChunk(),this._focusModel.setItems(this.leaves??[]),this._focusModel.initFocusIdx(0),this.notifySubscribers()};computeCodeChunk(){const e=[],t=this._editor.getLineChanges(),i=this._editor.getModel()?.original,o=this._editor.getModel()?.modified;if(t&&i&&o){for(const s of t){const r=je({startLineNumber:s.originalStartLineNumber,endLineNumber:s.originalEndLineNumber}),d=je({startLineNumber:s.modifiedStartLineNumber,endLineNumber:s.modifiedEndLineNumber}),c=Lt(this._editor,r,d);e.push(c)}return{id:crypto.randomUUID(),name:"",title:"",description:"",generationSource:"",supportedActions:[],children:e,childIds:e.map(s=>s.id)}}}handleInstructionSubmit=e=>{const t=this._editor.getModifiedEditor(),i=this.getSelectedCodeDetails(t);if(!i)throw Error("No selected code details found");const o=ut.select(this._reduxStore.getState());this._reduxStore.dispatch(lt(o,e,i))};updateModels=(e,t,i)=>{const o=this._editor.getModel()?.original?.uri,s=(i&&this._monaco.Uri.file(i.relPath))??o;if(s)if(o?.fsPath!==s.fsPath||o?.authority!==s.authority){const r=s.with({fragment:crypto.randomUUID()}),d=s.with({fragment:crypto.randomUUID()});this._editor.setModel({original:this._monaco.editor.createModel(e,void 0,r),modified:this._monaco.editor.createModel(t??"",void 0,d)})}else this._originalCode!==e&&this.getOriginalEditor().setValue(e),this._modifiedCode!==t&&this.getModifiedEditor().setValue(t??"");else console.warn("No URI found for diff view. Not updating models.")};updateTheme=e=>{this._monaco.editor.setTheme(e)};getSelectedCodeDetails(e){const t=e.getModel();if(!t)return null;const i=t.getLanguageId(),o=1,s=1,r={lineNumber:t.getLineCount(),column:t.getLineMaxColumn(t.getLineCount())},d=H(this._selectionLines);if(!d)throw new Error("No selection lines found");const c=Math.min(d.end+1,r.lineNumber),g=new this._monaco.Range(d.start+1,1,c,t.getLineMaxColumn(c));let u=t.getValueInRange(g);c<t.getLineCount()&&(u+=t.getEOL());const l=new this._monaco.Range(o,s,g.startLineNumber,g.startColumn),p=Math.min(g.endLineNumber+1,r.lineNumber),v=new this._monaco.Range(p,1,r.lineNumber,r.column);return{selectedCode:u,prefix:t.getValueInRange(l),suffix:t.getValueInRange(v),path:t.uri.path,language:i,prefixBegin:l.startLineNumber-1,suffixEnd:v.endLineNumber-1}}}function Lt(a,e,t){const i=a.getModel()?.original,o=a.getModel()?.modified;if(!i||!o)throw new Error("No models found");return function(s,r,d,c){return{id:crypto.randomUUID(),name:"",title:"",description:"",generationSource:"",supportedActions:[],unitOfCodeWork:{repoRoot:"",pathName:"",originalCode:s,modifiedCode:r,lineChanges:{lineChanges:[{originalStart:d.startLineNumber,originalEnd:d.endLineNumber,modifiedStart:c.startLineNumber,modifiedEnd:c.endLineNumber}],lineOffset:0}},children:[],childIds:[]}}(i.getValueInRange(e),o.getValueInRange(t),e,t)}function je(a){return a.endLineNumber===0?{startLineNumber:a.startLineNumber+1,startColumn:1,endLineNumber:a.startLineNumber+1,endColumn:1}:{startLineNumber:a.startLineNumber,startColumn:1,endLineNumber:a.endLineNumber+1,endColumn:1}}var Nt=k('<span class="c-keyboard-shortcut-hint__icon svelte-1s22lg"> </span>'),Vt=k("<span></span>");function oe(a,e){ue(e,!0);let t=Y(e,"class",3,""),i=Y(e,"keybinding",19,()=>{}),o=Y(e,"icons",19,()=>i()?.split("-")??[]);var s=Vt();qe(s,21,o,ze,(r,d)=>{var c=Nt(),g=F(c);le(()=>Ne(g,n(d))),f(r,c)}),le(()=>Ce(s,1,`c-keyboard-shortcut-hint ${t()}`,"svelte-1s22lg")),f(a,s),ce()}var Ot=k("<!> Accept",1),Ft=k("<!> Reject",1),$t=k("<div></div>  <div><div><!> <!></div></div>",1);function Dt(a,e){ue(e,!0);const t=()=>L(c,"$keybindingsStore",i),[i,o]=be();let s=Y(e,"align",3,"right"),r=Y(e,"heightInPx",3,1),d=Y(e,"disableApply",3,!1);const c=e.diffViewModel.keybindings;let g=D(0);const u=m=>{y(g,m,!0)};let l,p=D(!1);function v(){l&&(clearTimeout(l),l=void 0),y(p,!1)}function M(m){m.target.closest(".c-button-container")?v():m.type==="mouseenter"||m.type==="mousemove"?(v(),l=setTimeout(()=>{y(p,!0)},400)):m.type==="mouseleave"&&v()}var A=$t(),j=S(A);let z;Ge(j,(m,I)=>e.diffViewModel.renderActionsViewZone?.(m,I),()=>({chunk:e.leaf,heightInPx:r(),onDomNodeTop:u}));var P=w(j,2);let U;P.__mousemove=M;var T=F(P);let Q;var h=F(T),N=m=>{X(m,{size:1,variant:"ghost",color:"success",$$events:{click(...I){e.onAccept?.apply(this,I)}},children:(I,W)=>{var G=Ot();oe(S(G),{get keybinding(){return t().acceptFocusedChunk}}),f(I,G)},$$slots:{default:!0}})};Z(h,m=>{d()||m(N)});var B=w(h,2);X(B,{size:1,variant:"ghost",color:"error",$$events:{click(...m){e.onReject?.apply(this,m)}},children:(m,I)=>{var W=Ft();oe(S(W),{get keybinding(){return t().rejectFocusedChunk}}),f(m,W)},$$slots:{default:!0}}),le((m,I,W)=>{z=Ce(j,1,"svelte-1kwtokq",null,z,m),U=Ce(P,1,"c-chunk-action-panel-anchor svelte-1kwtokq",null,U,I),Be(P,`top: ${n(g)??""}px;`),Q=Ce(T,1,"c-button-container svelte-1kwtokq",null,Q,W)},[()=>({"c-chunk-diff-border--focused":!!e.leaf&&e.isFocused}),()=>({"c-chunk-action-panel-anchor--left":s()==="left","c-chunk-action-panel-anchor--right":s()==="right","c-chunk-action-panel-anchor--focused":e.isFocused}),()=>({"c-button-container--focused":e.isFocused,"c-button-container--transparent":n(p)})]),ge("mouseenter",P,M),ge("mouseleave",P,M),f(a,A),ce(),o()}Ue(["mousemove"]);var Rt=k('<span class="c-diff-page-counter svelte-17ip48s">Generating changes <!></span>'),At=k('<span class="c-diff-page-counter svelte-17ip48s"> <!></span>'),Pt=k('<span class="c-diff-page-counter svelte-17ip48s">No changes</span>'),Tt=k("<!> Back",1),Wt=k("<!> Next",1),jt=k("<!> Accept All",1),qt=k("<!> Reject All",1),zt=k("<!> <!>",1),Ut=k("<!> <!> <!>",1),Bt=k('<div class="c-top-action-panel-anchor svelte-17ip48s"><div class="c-button-container svelte-17ip48s"><!> <!> <!></div></div>');function Ht(a,e){ue(e,!0);const t=()=>L(e.diffViewModel,"$diffViewModel",r),i=()=>L(g,"$requestId",r),o=()=>L(n(M),"$isLoadingStore",r),s=()=>L(c,"$keybindingsStore",r),[r,d]=be(),c=e.diffViewModel.keybindings,g=e.diffViewModel.requestId;let u,l=R(()=>t().disableResolution),p=R(()=>t().disableApply),v=R(()=>t().currFocusedChunkIdx!==void 0?(t().currFocusedChunkIdx+1).toString():"x"),M=R(()=>t().isLoading),A=R(()=>!!t().leaves?.length),j=D("Copy request ID"),z=D(void 0);function P(b){b||(clearTimeout(u),u=void 0,y(j,"Copy request ID"))}async function U(){i()&&(await navigator.clipboard.writeText(i()),y(j,"Copied!"),clearTimeout(u),u=setTimeout(()=>n(z)?.requestClose(),1500))}var T=Bt(),Q=F(T),h=F(Q),N=b=>{{let V=R(()=>[wt.Hover]);me(bt(b,{onOpenChange:P,get content(){return n(j)},get triggerOn(){return n(V)},children:(x,J)=>{kt(x,{variant:"ghost",color:"neutral",size:1,onclick:U,children:(ee,_)=>{He(ee,{name:"copy"})},$$slots:{default:!0}})},$$slots:{default:!0}}),x=>y(z,x,!0),()=>n(z))}};Z(h,b=>{i()&&b(N)});var B=w(h,2),m=b=>{var V=Rt(),x=w(F(V));Ae(x,{size:1,get loading(){return o()}}),f(b,V)},I=b=>{var V=Ee(),x=S(V),J=_=>{var C=At(),O=F(C),E=w(O);Ae(E,{size:1,get loading(){return o()}}),le(()=>Ne(O,`${n(v)??""} of ${t()?.leaves?.length??""} `)),f(_,C)},ee=_=>{var C=Pt();f(_,C)};Z(x,_=>{n(A)?_(J):_(ee,!1)},!0),f(b,V)};Z(B,b=>{!n(A)&&o()?b(m):b(I,!1)});var W=w(B,2),G=b=>{var V=Ut(),x=S(V);X(x,{size:1,variant:"ghost",color:"neutral",get onclick(){return e.diffViewModel.focusPrevChunk},children:(C,O)=>{var E=Tt();oe(S(E),{get keybinding(){return s().focusPrevChunk}}),f(C,E)},$$slots:{default:!0}});var J=w(x,2);X(J,{size:1,variant:"ghost",color:"neutral",get onclick(){return e.diffViewModel.focusNextChunk},children:(C,O)=>{var E=Wt();oe(S(E),{get keybinding(){return s().focusNextChunk}}),f(C,E)},$$slots:{default:!0}});var ee=w(J,2),_=C=>{var O=zt(),E=S(O),te=ie=>{X(ie,{size:1,variant:"ghost",color:"success",get onclick(){return e.diffViewModel.acceptAllChunks},children:(_e,ne)=>{var pe=jt();oe(S(pe),{get keybinding(){return s().acceptAllChunks}}),f(_e,pe)},$$slots:{default:!0}})};Z(E,ie=>{L(n(p),"$disableApply",r)||ie(te)});var he=w(E,2);X(he,{size:1,variant:"ghost",color:"error",get onclick(){return e.diffViewModel.rejectAllChunks},children:(ie,_e)=>{var ne=qt();oe(S(ne),{get keybinding(){return s().rejectAllChunks}}),f(ie,ne)},$$slots:{default:!0}}),f(C,O)};Z(ee,C=>{L(n(l),"$disableResolution",r)||C(_)}),f(b,V)};Z(W,b=>{n(A)&&b(G)}),f(a,T),ce(),d()}var Zt=(a,e)=>{a.key==="Enter"&&(e(),a.stopPropagation(),a.preventDefault())},Gt=k("<!> <!> <!> <!>",1),Jt=k("Close <!>",1),Kt=k('<div class="instruction-overlay-wrapper"><div></div> <div class="instruction-drawer-panel svelte-7w2pxx"><div class="instruction-drawer-panel__contents svelte-7w2pxx" tabindex="0" role="button"><div class="l-input-area__input svelte-7w2pxx"><!></div> <div class="c-instruction-drawer-panel__btn-container svelte-7w2pxx"><!> <!></div></div></div></div>'),Qt=k("<!> <!>",1);function Xt(a,e){ue(e,!0);const t=()=>L(M,"$modeStore",s),i=()=>L(A,"$selectionLinesStore",s),o=()=>L(B,"$currentConversationId",s),[s,r]=be();let d=Y(e,"initialFlags",19,()=>{});const c=nt.getContext().monaco,g={isWholeLine:!0,marginClassName:"instruction-edit-area-margin"};let u,l,p=D(void 0),v=D("");const M=e.diffViewModel.mode,A=e.diffViewModel.selectionLines;let j=R(()=>(t()===ae.instruction?"Instruct":"Edit with")+" Augment... @ to focus on files or docs");function z(){const _=e.diffViewModel.getModifiedEditor(),C=H(c);if(!_||!C||(l?.clear(),!i()))return;const O=i().start,E=i().end,te={range:new C.Range(O+1,1,E+1,1),options:g};l||(l=_.createDecorationsCollection()),l.set([te])}function P(){return!!n(v)?.trim()&&(e.diffViewModel.handleInstructionSubmit(n(v)),!0)}xe(async()=>{await Me(),W(),y(U,e.diffViewModel.editorOffset,!0)}),Ze(()=>{u?.destroy(),l?.clear()});let U=D(0),T=D(57),Q=R(()=>L(e.diffViewModel,"$diffViewModel",s).isLoading);ke(()=>{if(n(p)){if(i()==null)y(T,0);else{const _=n(p).scrollHeight;y(T,Math.min(40+_,108),!0)}u?.update({heightInPx:n(T)}),z()}});let h=D(void 0),N=D(void 0);const B=ht(),m=Se(),I=()=>n(h)?.requestFocus(),W=()=>n(h)?.forceFocus(),G=_=>{o()&&m(ft(o(),_.current))};function b(_){y(v,_.rawText,!0)}var V=Qt(),x=S(V);(function(_,C){ue(C,!0);const O=Y(C,"featureFlags",19,()=>({})),E=Se();xe(()=>{O()&&E(ct({areFlagsReady:!0,...O()}))}),ce()})(0,{get featureFlags(){return d()}});var J=w(x,2),ee=_=>{var C=Kt(),O=F(C);Ge(O,K=>function(re){const q=i()?i().start:1;return u=e.diffViewModel.renderInstructionsDrawerViewZone(re,{line:q,heightInPx:n(T),onDomNodeTop:ve=>{y(U,e.diffViewModel.editorOffset+ve)},autoFocus:!0}),z(),{destroy(){u&&(u.destroy(),u=void 0),l&&(l.clear(),l=void 0)}}}(K));var E=w(O,2),te=F(E);te.__click=W,te.__keydown=[Zt,W];var he=F(te),ie=F(he);Pe(ie,()=>We.Root,(K,re)=>{me(re(K,{focusOnInit:!0,children:(q,ve)=>{var fe=Gt(),Ve=S(fe);yt(Ve,{shortcuts:{Enter:()=>P()}});var Oe=w(Ve,2);me(It(Oe,{requestEditorFocus:I,onMentionItemsUpdated:G}),we=>y(N,we,!0),()=>n(N));var Fe=w(Oe,2);Pe(Fe,()=>We.Content,(we,Qe)=>{Qe(we,{get content(){return n(v)},onContentChanged:b})});var Ke=w(Fe,2);Mt(Ke,{get placeholder(){return n(j)}}),f(q,fe)},$$slots:{default:!0}}),q=>y(h,q,!0),()=>n(h))}),me(he,K=>y(p,K),()=>n(p));var _e=w(he,2),ne=F(_e);X(ne,{id:"close",size:1,variant:"soft",color:"neutral",title:"Close",get onclick(){return e.diffViewModel.disposeDiffViewPanel},children:(K,re)=>{var q=Jt();oe(w(S(q)),{keybinding:"esc"}),f(K,q)},$$slots:{default:!0}});var pe=w(ne,2);{let K=R(()=>t()===ae.instruction?"Instruct Augment":"Edit with Augment"),re=R(()=>!n(v).trim()||L(n(Q),"$isLoadingStore",s));X(pe,{id:"send",size:1,variant:"solid",color:"accent",get title(){return n(K)},get disabled(){return n(re)},onclick:P,children:(q,ve)=>{var fe=et();le(()=>Ne(fe,t()===ae.instruction?"Instruct":"Edit")),f(q,fe)},$$slots:{default:!0,iconRight:(q,ve)=>{He(q,{slot:"iconRight",name:"send-horizontal"})}}})}le(()=>Be(E,`top: ${n(U)??""}px; height: ${n(T)??""}px;`)),f(_,C)};Z(J,_=>{i()&&_(ee)}),f(a,V),ce(),r()}Ue(["click","keydown"]);var Yt=k('<div class="sticky-top svelte-1nhwlxa"><!></div> <!>',1),ei=k('<div class="diff-view-container svelte-1nhwlxa"><!> <div class="editor-container svelte-1nhwlxa"><div class="editor svelte-1nhwlxa"></div> <!></div></div>');function ti(a,e){ue(e,!0);const t=()=>L(it,"$themeStore",o),i=()=>L(n(r),"$diffViewModel",o),[o,s]=be();let r=D(void 0),d=D(void 0),c=R(()=>n(r)?.disableApply),g=R(()=>n(r)?.disableResolution);const u=Se();function l(h){const N=st.dark;return rt(h?.category||N,h?.intensity)??dt.get(N)}ke(()=>{const h=t();n(r)&&n(r)?.updateTheme(l(h))});let p=D(void 0);ke(()=>{n(p)&&n(d)&&!n(r)&&tt(y(r,new St(n(d),gt().store,l(t()),n(p)),!0),"$diffViewModel",o)}),xe(async()=>{y(p,await window.augmentDeps.monaco,!0),n(p)?u(mt(void 0,{})):console.error("Monaco not loaded. Diff view cannot be initialized.")}),Ze(()=>{n(r)?.dispose()});let v=R(()=>i()?.leaves),M=D(!1);ke(()=>{n(r)?.updateIsWebviewFocused(n(M))});var A=ei();ge("message",Ie,function(...h){n(r)?.handleMessageFromExtension?.apply(this,h)}),ge("focus",Ie,()=>y(M,!0)),ge("blur",Ie,()=>y(M,!1));var j=F(A),z=h=>{var N=Yt(),B=S(N);Ht(F(B),{get diffViewModel(){return i()}}),Xt(w(B,2),{get diffViewModel(){return i()}}),f(h,N)};Z(j,h=>{i()&&h(z)});var P=w(j,2),U=F(P);me(U,h=>y(d,h),()=>n(d));var T=w(U,2),Q=h=>{var N=Ee(),B=S(N);qe(B,17,()=>n(v),ze,(m,I,W)=>{var G=Ee(),b=S(G),V=x=>{{let J=R(()=>i()?.currFocusedChunkIdx===W);Dt(x,{get isFocused(){return n(J)},onAccept:()=>i()?.acceptChunk(n(I)),onReject:()=>i()?.rejectChunk(n(I)),get diffViewModel(){return i()},get leaf(){return n(I)},align:"right",get disableApply(){return L(n(c),"$disableApply",o)}})}};Z(b,x=>{n(I).unitOfCodeWork.modifiedCode!==n(I).unitOfCodeWork.originalCode&&x(V)}),f(m,G)}),f(h,N)};Z(T,h=>{i()&&n(v)?.length&&!L(n(g),"$disableResolution",o)&&h(Q)}),f(a,A),ce(),s()}ot(function(a){at.Root(a,{children:(e,t)=>{_t(e,{children:(i,o)=>{pt(i,{children:(s,r)=>{ti(s,{})},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}})},{target:document.getElementById("app")});
//# sourceMappingURL=diff-view-Ca-yjrQJ.js.map
